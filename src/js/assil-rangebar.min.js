function getRect(n){if(!n||n.x&&n.y&&n.w&&n.h)return n;var t=$(n).offset();return{x:t.left,y:t.top,w:$(n).width(),h:$(n).height()}}function isOverlapRect(n,t){var i={isOverlapRight:n.x+n.w>=t.x&&n.x<=t.x,isOverlapLeft:n.x<=t.x+t.w&&n.x>=t.x,isOverlapBottom:n.y+n.h>t.y&&n.y<=t.y,isOverlapTop:n.y<=t.y+t.h&&n.y>=t.y};return i.isOverlaped=i.isOverlapLeft||i.isOverlapRight||i.isOverlapTop||i.isOverlapBottom,i}function isOverlapXRect(n,t){var i={isOverlapRight:n.x+n.w>=t.x&&n.x<=t.x,isOverlapLeft:n.x<=t.x+t.w&&n.x>=t.x};return i.isOverlaped=i.isOverlapLeft||i.isOverlapRight,i}function isOverlapYRect(n,t){var i={isOverlapBottom:n.y+n.h>=t.y&&n.y<=t.y,isOverlapTop:n.y<=t.y+t.h&&n.y>=t.y};return i.isOverlaped=i.isOverlapTop||i.isOverlapBottom,i}(function(n){function u(t,i){var r=n(t.target),o=r.data("range"),f=n(t.target).parent(),h=getRect(f),u=getRect(r),c=r.data("ui-position")||i.position,s={x:i.position.left-c.left,y:i.position.top-c.top},e;console.log("input ui.position:"+JSON.stringify(i.position));console.log("input mouseOffset:"+JSON.stringify(s));i.size?(u.w=i.size.width+s.x,i.position.left+i.size.width>h.w&&(i.size.width=h.w-i.position.left),i.position.left=i.position.left<0?0:i.position.left):u.x=i.position.left+s.x;console.log("   range position:"+JSON.stringify(u));e=n(u).overlapsX(r.siblings());e.length>0&&o.canOverlap?r.addClass("overlaped"):e.length==0&&o.canOverlap&&r.removeClass("overlaped");e.length>0&&!o.canOverlap&&(n.each(e,function(){var e=this,s=n(e.obstacle),h=s.data("range"),o;if(h.canOverlap)return s.addClass("overlaped"),!0;if(f.trigger("overlap",[t,i,e,f,r,e.obstacle]),o=getRect(e.obstacle),console.log("    obstacle rect:"+JSON.stringify(o)),i.size)return e.overlap.isOverlapLeft?(i.position.left=o.x+o.w,i.size.width=i.originalPosition.left+i.originalSize.width-i.position.left):e.overlap.isOverlapRight&&(i.size.width=o.x-u.x),!0;e.overlap.isOverlapLeft?i.position.left=o.x+o.w:e.overlap.isOverlapRight&&(i.position.left=o.x-u.w)}),f.trigger("change",[t,i,f,r]),console.log("      source rect:"+JSON.stringify(u)));console.log("result          :"+JSON.stringify(i.position))}function f(n,i){u(n,i);t(n,i)}function e(i,r){t(i,r);n(i.target).addClass("dragging")}function o(n,i){u(n,i);t(n,i)}function s(i,r){t(i,r);n(i.target).removeClass("dragging")}function h(t){t.stopPropagation();t.preventDefault();var i=n(this),r=i.parent(),u=r.data("rangebar");t.which===2&&u.allowDelete&&(i.data("deleteConfirm")?(r.removeRange(i.data("range").id),clearTimeout($el.data("deleteTimeout"))):(i.addClass("delete-confirm"),i.data("deleteConfirm",!0),this.deleteTimeout=setTimeout(function(){i.removeClass("delete-confirm");i.data("deleteConfirm",!1)},u.deleteTimeout)))}function t(t,u){var f=n(t.target),e=f.data("range"),o=f.parent(),s=o.data("assilRangebar").options,h=s.max-s.min,c=o.width(),l=u?u.position.left:f.offset().left;e=n.fn.extend(e,{start:r(h,i(c,l)),end:r(h,i(c,l+(u&&u.size?u.size.width:f.width())))});f.height(o.height());f.data("range",e);n(".range-label",f).text(s.label(f,e))}function c(n,t,u){return{left:r(t,i(n,u.start)),right:r(t,i(n,u.end))}}function i(n,t){return t*100/n}function r(n,t){return n*t/100}n.widget("assil.rangebar",{options:{defaultRange:{start:3,end:9,disabled:!1,css:"",canOverlap:!1},min:0,max:100,ranges:[],label:function(n){return parseInt(n.start)+"-"+parseInt(n.end)},allowDelete:!0,deleteTimeout:3e3},_create:function(){this.element.addClass("range-bar").disableSelection();this.setRanges(this.options.ranges)},_destroy:function(){},addRange:function(i){var l=this.options,u;i=n.fn.extend({},l.defaultRange,i);var a=l.max-l.min,r=n("<div class='range'>").data("range",i),v=r.append("<div class='range-label'>&nbsp;<\/div>");if(this.element.append(r),u=c(a,this.element.width(),i),r.offset({left:u.left,top:this.element.offset().top}),r.width(u.right-u.left),r.height(this.element.height()),i.css&&r.addClass(i.css),t({target:r}),i.disabled)return r.addClass("disabled"),!0;r.resizable({containment:this.element,handles:"e, w",resize:f});r.draggable({containment:this.element,scroll:!1,axis:"x",handle:".range-label",start:e,drag:o,stop:s});r.on("click",h);return r},removeRange:function(t){var i=this.element.chiden();i.each(function(){var i=n(this),r=i.data("range");return r.id!=t?!0:($el.remove(),!1)})},setRanges:function(t){var i=this;n(i.element.children()).remove();n.each(t,function(){i.addRange(this)})}})})(jQuery),function(n){n.fn.measureRects=function(){var n=[];return this.each(function(){n.push(getRect(this))}),n};n.fn.pointOverlaps=function(t,i){var r=[],u=i||isOverlapRect;return this.each(function(){var i=this,e=n(i),f=getRect(this);n.each(t,function(){var n=this,e=getRect(n),t=u(f,e);t.isOverlaped&&r.push({src:i,obstacle:n,overlap:t})})}),r};n.fn.pointOverlapsX=function(n){return this.pointOverlaps(n,isOverlapXRect)};n.fn.pointOverlapsY=function(n){return this.pointOverlaps(n,isOverlapYRect)};n.fn.overlaps=function(t,i){try{var r=[],u=i||isOverlapRect;return this.each(function(){var i=this,e=n(i),f=getRect(this);n(t).each(function(){var t=this,o=n(t),s=getRect(o),e=u(f,s);e.isOverlaped&&r.push({src:i,obstacle:t,overlap:e})})}),r}catch(f){console.log(f)}};n.fn.overlapsX=function(n){return this.overlaps(n,isOverlapXRect)};n.fn.overlapsY=function(n){return this.overlaps(n,isOverlapYRect)}}(jQuery);