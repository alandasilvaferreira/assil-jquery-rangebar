function getRectUsing$Offset(n){if(!n||n.x!=undefined&&n.y!=undefined&&n.w!=undefined&&n.h!=undefined)return n;var t=$(n).offset();return{x:t.left,y:t.top,w:$(n).width(),h:$(n).height()}}function getRectUsing$Position(n){if(!n||n.x!=undefined&&n.y!=undefined&&n.w!=undefined&&n.h!=undefined)return n;var t=$(n).position();return{x:t.left,y:t.top,w:$(n).width(),h:$(n).height()}}function isOverlapRect(n,t){var i={isOverlapRight:n.x+n.w>=t.x&&n.x<=t.x,isOverlapLeft:n.x<=t.x+t.w&&n.x>=t.x,isOverlapBottom:n.y+n.h>t.y&&n.y<=t.y,isOverlapTop:n.y<=t.y+t.h&&n.y>=t.y};return i.isOverlaped=i.isOverlapLeft||i.isOverlapRight||i.isOverlapTop||i.isOverlapBottom,i}function isOverlapXRect(n,t){var i={isOverlapRight:n.x+n.w>=t.x&&n.x<=t.x,isOverlapLeft:n.x<=t.x+t.w&&n.x>=t.x};return i.isOverlaped=i.isOverlapLeft||i.isOverlapRight,i}function isOverlapYRect(n,t){var i={isOverlapBottom:n.y+n.h>=t.y&&n.y<=t.y,isOverlapTop:n.y<=t.y+t.h&&n.y>=t.y};return i.isOverlaped=i.isOverlapTop||i.isOverlapBottom,i}var assil={debgug:!0};(function(n){function u(t,i){var c=getRectUsing$Position,r=n(t.target),l=r.data("range"),u=n(t.target).parent(),v=c(u),f={x:i.position.left,y:i.position.top,w:i.size.width,h:i.size.height},e=r.data("last-range-rect")||f,a={x:i.position.left-i.originalPosition.left,y:i.position.top-i.originalPosition.top,w:i.size.width-i.originalSize.width,h:i.size.height-i.originalSize.height},h,o,s;assil.debgug&&console.log("input ui.position:"+JSON.stringify(i.position));assil.debgug&&console.log("input mouseOffset:"+JSON.stringify(a));assil.debgug&&console.log("   range position:"+JSON.stringify(f));h=[];r.siblings().each(function(){this_rect=c(this);this_rect.$el=this;h.push(this_rect)});o=n(f).overlapsX(h);o.length>1&&l.canOverlap?r.addClass("overlaped"):o.length==1&&l.canOverlap&&r.removeClass("overlaped");o.length>0&&!l.canOverlap&&(s=null,n.each(o,function(){var t=this,i=n(t.obstacle.$el),r=i.data("range");return r?r.canOverlap?(i.addClass("overlaped"),!0):(s=t,!1):!0}),s&&(u.trigger("overlap",[t,i,s,u,r,s.obstacle]),assil.debgug&&console.log("    obstacle rect:"+JSON.stringify(c(s.obstacle))),i.revert=!0),u.trigger("change",[t,i,u,r]),assil.debgug&&console.log("      source rect:"+JSON.stringify(f)),o=n(f).overlapsX(h),n.each(o,function(){var r=this,u=n(r.obstacle.$el),t=u.data("range");return t?t.canOverlap?!0:(i.revert=!0,!1):!0}));i.revert||(i.position.left=i.position.left<0?0:i.position.left,i.position.left=i.position.left+f.w>u.width()?u.width()-f.w:i.position.left);i.revert&&(i.position.left=e.x,i.position.top=e.y,i.size.width=e.w,i.size.height=e.h);e={x:i.position.left,y:i.position.top,x:i.position.left,w:i.size.width,h:i.size.height};r.data("last-range-rect",e);assil.debgug&&console.log("result          :"+JSON.stringify(e))}function f(t,i){var h=getRectUsing$Position,u=n(t.target),c=u.data("range"),e=n(t.target).parent(),a=h(e),r={x:i.position.left,y:i.position.top,w:u.width(),h:u.height()},f=u.data("last-range-rect")||r,l={x:i.position.left-f.x,y:i.position.top-f.y,w:r.w-f.w,h:r.h-f.h},s,o;assil.debgug&&console.log("input ui.position:"+JSON.stringify(i.position));assil.debgug&&console.log("input mouseOffset:"+JSON.stringify(l));assil.debgug&&console.log("   range position:"+JSON.stringify(r));s=[];u.siblings().each(function(){this_rect=h(this);this_rect.$el=this;s.push(this_rect)});o=n(r).overlapsX(s);o.length>1&&c.canOverlap?u.addClass("overlaped"):o.length==1&&c.canOverlap&&u.removeClass("overlaped");o.length>0&&!c.canOverlap&&(n.each(o,function(){var r=this,f=n(r.obstacle.$el),o=f.data("range"),s;if(!o)return!0;if(o.canOverlap)return f.addClass("overlaped"),!0;e.trigger("overlap",[t,i,r,e,u,r.obstacle]);s=h(r.obstacle);assil.debgug&&console.log("    obstacle rect:"+JSON.stringify(s));i.revert=!0}),assil.debgug&&console.log("      source rect:"+JSON.stringify(r)),o=n(r).overlapsX(s),n.each(o,function(){var r=this,u=n(r.obstacle.$el),t=u.data("range");return t?t.canOverlap?!0:(i.revert=!0,!1):!0}));i.revert||(i.position.left=i.position.left<0?0:i.position.left,i.position.left=i.position.left+r.w>e.width()?e.width()-r.w:i.position.left);i.revert&&(i.position.left=f.x,i.position.top=f.y);e.trigger("change",[t,i,e,u]);f={x:i.position.left,y:i.position.top,x:i.position.left,w:r.w,h:r.h};u.data("last-range-rect",f);assil.debgug&&console.log("result          :"+JSON.stringify(f))}function e(n,i){u(n,i);t(n,i)}function o(i,r){t(i,r);n(i.target).addClass("dragging")}function s(n,i){f(n,i);t(n,i)}function h(i,r){t(i,r);n(i.target).removeClass("dragging")}function c(){}function l(t){t.stopPropagation();t.preventDefault();var i=n(this),r=i.parent(),u=i.data("range"),f=i.siblings().data("range")}function a(t){t.stopPropagation();t.preventDefault();var i=n(this),r=i.parent(),u=r.data().assilRangebar.options,f=n(r.data("selected_range"));(f!=null&&f.removeClass("selected"),r.data("selected_range",i),i.addClass("selected"),t.which===2&&u.allowDelete)&&(i.data("deleteConfirm")?(r.removeRange(i.data("range").id),clearTimeout($el.data("deleteTimeout"))):(i.addClass("delete-confirm"),i.data("deleteConfirm",!0),this.deleteTimeout=setTimeout(function(){i.removeClass("delete-confirm");i.data("deleteConfirm",!1)},u.deleteTimeout)))}function t(t,u){var f=n(t.target),e=f.data("range"),o=f.parent(),s=o.data("assilRangebar").options,h=s.max-s.min,c=o.width(),l=u&&u.position?u.position.left:f.position().left,a=u&&u.size?u.size.width:f.width();e=n.fn.extend(e,{start:r(h,i(c,l)),end:r(h,i(c,l+a))});f.height(o.height());f.data("range",e);n(".range-label",f).text(s.label(f,e))}function v(n,t,u){return{left:r(t,i(n,u.start)),right:r(t,i(n,u.end))}}function i(n,t){return t*100/n}function r(n,t){return n*t/100}n.widget("assil.rangebar",{options:{defaultRange:{start:3,end:9,disabled:!1,css:{range:"",label:""},canOverlap:!1},min:0,max:100,ranges:[],label:function(n){return parseInt(n.start)+"-"+parseInt(n.end)},allowDelete:!0,deleteTimeout:3e3},_create:function(){var t=this;t.element.addClass("range-bar").disableSelection();t.setRanges(t.options.ranges);t.element.resize(function(){var i=n(t.element);n.each(i.children(),function(){var i=n(this);if(range=i.data("range"),!range)return!0;t.updateRangeUI(i)})})},_destroy:function(){},getRanges:function(){var t=[];return n(this.element).children().each(function(){var r=n(this),i=r.data("range");if(!i)return!0;t.push(i)}),t.sort(function(n,t){return n.start<t.start?-1:n.start>t.start?1:n.end<t.end?-1:n.end>t.end?1:0}),t},addRange:function(t){var r=this.options;t=n.fn.extend({},r.defaultRange,t);var f=r.max-r.min,i=n("<div class='range' tabindex='1'>").data("range",t),u=i.append("<div class='range-label'>&nbsp;<\/div>");if(this.element.append(i),t.css&&(i.addClass(t.css.range),u.addClass(t.css.label)),t.disabled)return i.addClass("disabled"),!0;i.draggable({containment:this.element,scroll:!1,axis:"x",handle:".range-label",start:o,drag:s,stop:h}).resizable({containment:this.element,handles:"e, w",resize:e});i.on("mousedown",a).on("keydown",c).on("dblclick",l);return this.updateRangeUI(i),i},removeRange:function(t){var i=this.element.chiden();i.each(function(){var i=n(this),r=i.data("range");return r.id!=t?!0:($el.remove(),!1)})},setRanges:function(t){var i=this;n(i.element.children()).remove();n.each(t,function(){i.addRange(this)})},updateRangeUI:function(t){var f=this.options,r=n(this.element),u=n(t).data("range"),i=this.getRelativeUIRectFromRange(u);t.offset({left:i.x+r.offset().left,top:i.y+r.offset().top});t.width(i.w);t.height(i.h);n(".range-label",t).text(f.label(t,u));assil.debgug&&console.log("UI range rect after change:"+JSON.stringify(getRectUsing$Position(t)))},getRelativeUIRectFromRange:function(t){var r=n(this.element),f=this.options.max-this.options.min,i=v(f,r.width(),t),u={x:i.left,y:0,w:i.right-i.left,h:r.height()};return assil.debgug&&console.log("relative rect of : "+JSON.stringify(t)),assil.debgug&&console.log("point:"+JSON.stringify(i)),assil.debgug&&console.log("relative rect:"+JSON.stringify(u)),u}})})(jQuery),function(n){n.fn.measureRects=function(){var n=[];return this.each(function(){n.push(getRect(this))}),n};n.fn.overlaps=function(t,i,r){try{var u=[],f=r||getRectUsing$Offset,e=i||isOverlapRect;return this.each(function(){var i=this,r=f(i);n(t).each(function(){var n=this,o=f(n),t=e(r,o);t.isOverlaped&&u.push({src:i,obstacle:n,overlap:t})})}),u}catch(o){console.log(o)}};n.fn.overlapsX=function(n,t){return this.overlaps(n,isOverlapXRect,t)};n.fn.overlapsY=function(n,t){return this.overlaps(obj,isOverlapYRect,t)}}(jQuery);